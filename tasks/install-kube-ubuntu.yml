---
- name: add gpg key
  apt_key:
    url: "{{ kube_ubuntu_repo_gpg }}"

- name: add apt repo
  apt_repository:
    repo: "{{ kube_ubuntu_apt_repo }}"
    update_cache: yes

- name: install k8s package
  apt:
    name:
      - kubelet
      - kubeadm
      - kubectl
    state: present

#- name: add cgroup driver
#  lineinfile:
#    path: "{{kubeadm_conf}}"
#    insertafter: 'Environment="KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml"'
#    line: Environment="cgroup-driver=cgroupfs"

- name: change cgroup driver from systemd to cgroupfs
  lineinfile:
    path: "{{kubelet_conf}}"
    search_string: "cgroupDriver: systemd"
    line: "cgroupDriver: cgroupfs"
    state: present

- name: restart kubelet
  service: name=kubelet state=restarted







